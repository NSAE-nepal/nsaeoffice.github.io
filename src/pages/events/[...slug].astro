---
import { SITE_DESCRIPTION } from "@/consts";
import PageLayout from "@/layouts/PageLayout.astro";
import { getCollection, render, type CollectionEntry } from "astro:content";
import ArrowLeft from "@tabler/icons/outline/arrow-left.svg";

import EventContact from "@/components/pages/events/EventContact.astro";
import EventLocation from "@/components/pages/events/EventLocation.astro";
import EventHeader from "@/components/pages/events/EventHeader.astro";
import EventSchedule from "@/components/pages/events/EventSchedule.astro";
import EventInstructors from "@/components/pages/events/EventInstructors.astro";

export async function getStaticPaths() {
  const events = await getCollection("events", ({ data }) => {
    return import.meta.env.MODE !== "production" || data.draft === false;
  });

  return events.map((event) => ({
    params: { slug: event.id },
    props: event,
  }));
}

type Props = CollectionEntry<"events">;
const event = Astro.props;
const { data } = event;
const { Content } = await render(event);
---

<PageLayout title={data.title} description={data.subtitle || SITE_DESCRIPTION}>
  <article class="py-8 space-y-10">
    <a
      href="/events/page/1"
      class="inline-flex items-center gap-2 font-mono text-xs uppercase tracking-widest text-muted-foreground hover:text-primary transition-colors px-4"
    >
      <ArrowLeft class="size-4" /> Back to All Events
    </a>

    <EventHeader data={data} />

    <hr class="my-8 border-muted" />

    <div class="grid grid-cols-1 lg:grid-cols-[3fr_1.5fr] gap-8 lg:gap-12">
      <div class="flex flex-col gap-10">
        <section>
          <h2 class="font-sans text-2xl font-medium tracking-tight mb-4">
            About the Event
          </h2>
          <div
            class="prose prose-lg prose-headings:font-sans prose-p:font-sans dark:prose-invert max-w-none"
          >
            <Content />
          </div>
        </section>

        <EventSchedule schedule={data.eventSchedule} />
      </div>

      <aside class="flex flex-col gap-6 lg:sticky lg:top-24 h-fit">
        <EventLocation location={data.location} />
        <EventInstructors instructors={data.instructors} />
        <EventContact contactPersons={data.contactPersons} />
      </aside>
    </div>
  </article>
</PageLayout>
